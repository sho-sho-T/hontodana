# 要件ドキュメント

## 概要

Next.js、Prisma、Supabase、PostgreSQLを使用した基本的な認証機能を実装します。この機能により、ユーザーは安全にアプリケーションにログインし、認証状態に基づいて適切な画面が表示されます。

## 要件

### 要件1：メール認証

**ユーザーストーリー：** ユーザーとして、メールアドレスとパスワードでログインできるようにしたい。これにより、個人のアカウントにアクセスできる。

#### 受け入れ基準

1. ユーザーが有効なメールアドレスとパスワードを入力したとき、システムは認証を成功させる
2. ユーザーが無効な認証情報を入力したとき、システムは適切なエラーメッセージを表示する
3. ユーザーがログインに成功したとき、システムはダッシュボード画面にリダイレクトする
4. システムは認証状態をセッションまたはトークンで管理する

### 要件2：Google認証

**ユーザーストーリー：** ユーザーとして、Googleアカウントでログインできるようにしたい。これにより、簡単に個人のアカウントにアクセスできる。

#### 受け入れ基準

1. ユーザーがGoogleでログインボタンをクリックしたとき、システムはGoogleの認証画面にリダイレクトする
2. ユーザーがGoogleでの認証を完了したとき、システムは認証を成功させる
3. Google認証が成功したとき、システムはダッシュボード画面にリダイレクトする
4. システムはGoogle認証の状態をセッションまたはトークンで管理する
5. 初回Google認証時、システムは自動的にユーザーアカウントを作成する

### 要件3：認証画面の表示

**ユーザーストーリー：** 未認証のユーザーとして、ログインフォームが表示される画面にアクセスしたい。これにより、認証情報を入力してログインできる。

#### 受け入れ基準

1. 未認証のユーザーがアプリケーションにアクセスしたとき、システムは認証画面を表示する
2. 認証画面にはメールアドレス入力フィールドが含まれる
3. 認証画面にはパスワード入力フィールドが含まれる
4. 認証画面にはメールログインボタンが含まれる
5. 認証画面にはGoogleでログインボタンが含まれる
6. フォームの入力値が無効な場合、システムは適切なバリデーションエラーを表示する

### 要件4：ダッシュボード画面の表示

**ユーザーストーリー：** 認証済みのユーザーとして、ログイン後にダッシュボード画面を表示したい。これにより、アプリケーションの主要機能にアクセスできる。

#### 受け入れ基準

1. 認証済みのユーザーがアプリケーションにアクセスしたとき、システムはダッシュボード画面を表示する
2. ダッシュボード画面にはユーザー情報が表示される
3. ダッシュボード画面にはログアウト機能が含まれる
4. 未認証のユーザーがダッシュボード画面に直接アクセスしようとしたとき、システムは認証画面にリダイレクトする

### 要件5：認証状態の管理

**ユーザーストーリー：** ユーザーとして、一度ログインしたら再度ログインする必要がないようにしたい。これにより、スムーズにアプリケーションを使用できる。

#### 受け入れ基準

1. ユーザーがログインしたとき、システムは認証状態を永続化する
2. ユーザーがブラウザを再起動しても、システムは認証状態を維持する
3. ユーザーがログアウトしたとき、システムは認証状態をクリアする
4. 認証トークンが期限切れの場合、システムは自動的にログアウト処理を実行する

### 要件6：セキュリティ

**ユーザーストーリー：** ユーザーとして、個人情報が安全に保護されることを期待する。これにより、安心してアプリケーションを使用できる。

#### 受け入れ基準

1. パスワードがデータベースに保存される前に、システムはハッシュ化を実行する
2. 認証トークンが適切に暗号化される
3. システムはCSRF攻撃を防ぐための対策を実装する
4. システムは適切なHTTPSリダイレクトを実装する
5. 認証失敗時に、システムは詳細なエラー情報を漏洩しない

### 要件7：ユーザー登録

**ユーザーストーリー：** 新規ユーザーとして、アカウントを作成できるようにしたい。これにより、アプリケーションを使用開始できる。

#### 受け入れ基準

1. ユーザーが有効なメールアドレスとパスワードを入力したとき、システムは新しいアカウントを作成する
2. システムは既存のメールアドレスでの重複登録を防ぐ
3. パスワードが最小要件（8文字以上）を満たさない場合、システムはエラーメッセージを表示する
4. アカウント作成が成功したとき、システムは自動的にユーザーをログイン状態にする