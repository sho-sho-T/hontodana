# TASK-301: ユーザープロフィール・設定画面 - TDDテストケース

## 正常系テストケース（基本的な動作）

### 1. プロフィール表示テスト

- **テスト名**: ユーザープロフィール情報の正常表示
  - **何をテストするか**: 認証済みユーザーのプロフィール情報が正しく表示される
  - **期待される動作**: ユーザー名、メールアドレス、アバター画像が表示される
  - **入力値**: 有効なユーザーセッション
  - **期待値**: User情報の表示（name, email, avatar_url）
  - **信頼性レベル**: 🟢 (interfaces.tsのUser型定義に基づく)

- **テスト名**: 設定情報の正常表示
  - **何をテストするか**: ユーザーの現在の設定が正しく表示される
  - **期待される動作**: テーマ、表示モード、読書目標などが表示される
  - **入力値**: UserPreferencesデータ
  - **期待値**: 設定値の正確な表示
  - **信頼性レベル**: 🟢 (interfaces.tsのUserPreferences型定義に基づく)

### 2. プロフィール更新テスト

- **テスト名**: ユーザー名の正常更新
  - **何をテストするか**: 有効なユーザー名での更新処理が成功する
  - **期待される動作**: データベース更新とUI反映が完了する
  - **入力値**: `{ name: "新しいユーザー名" }`
  - **期待値**: 更新成功レスポンスとUI更新
  - **信頼性レベル**: 🟡 (既存のsupabase実装パターンから推測)

- **テスト名**: メールアドレスの正常更新
  - **何をテストするか**: 有効なメールアドレスでの更新処理が成功する
  - **期待される動作**: Supabase Auth経由での更新が完了する
  - **入力値**: `{ email: "new@example.com" }`
  - **期待値**: 更新成功とメール認証通知
  - **信頼性レベル**: 🟡 (Supabase Auth仕様から推測)

### 3. 設定更新テスト

- **テスト名**: テーマ設定の正常更新
  - **何をテストするか**: テーマ選択の変更が正しく保存・反映される
  - **期待される動作**: テーマがリアルタイムで切り替わり、設定が永続化される
  - **入力値**: `{ theme: 'dark' }`
  - **期待値**: ダークテーマの適用と設定保存
  - **信頼性レベル**: 🟢 (interfaces.tsの型定義に基づく)

- **テスト名**: 表示設定の正常更新
  - **何をテストするか**: 表示モードと表示件数の変更が正しく保存される
  - **期待される動作**: 設定値がデータベースに保存され、本棚表示に反映される
  - **入力値**: `{ display_mode: 'list', books_per_page: 50 }`
  - **期待値**: リスト表示への切り替えと設定保存
  - **信頼性レベル**: 🟢 (interfaces.tsの型定義に基づく)

## 異常系テストケース（エラー処理）

### 4. バリデーションエラーテスト

- **テスト名**: 無効なユーザー名でのエラー処理
  - **何をテストするか**: 空文字や長すぎるユーザー名でエラーが適切に処理される
  - **期待される動作**: バリデーションエラーメッセージが表示される
  - **入力値**: `{ name: "" }` または `{ name: "a".repeat(51) }`
  - **期待値**: "ユーザー名は1文字以上50文字以下で入力してください"
  - **信頼性レベル**: 🟡 (要件定義のバリデーションルールから推測)

- **テスト名**: 無効なメールアドレスでのエラー処理
  - **何をテストするか**: 不正な形式のメールアドレスでエラーが処理される
  - **期待される動作**: メール形式エラーメッセージが表示される
  - **入力値**: `{ email: "invalid-email" }`
  - **期待値**: "有効なメールアドレスを入力してください"
  - **信頼性レベル**: 🟡 (一般的なフォームバリデーションから推測)

- **テスト名**: 読書目標の範囲外エラー処理
  - **何をテストするか**: 1-1000の範囲外の値でエラーが処理される
  - **期待される動作**: 範囲外エラーメッセージが表示される
  - **入力値**: `{ reading_goal: 0 }` または `{ reading_goal: 1001 }`
  - **期待値**: "読書目標は1冊以上1000冊以下で設定してください"
  - **信頼性レベル**: 🟡 (要件定義のバリデーションルールから推測)

### 5. 認証エラーテスト

- **テスト名**: 未認証ユーザーのアクセス拒否
  - **何をテストするか**: 未ログインユーザーがプロフィール画面にアクセスできない
  - **期待される動作**: ログイン画面へのリダイレクトが発生する
  - **入力値**: null session
  - **期待値**: 認証画面への遷移
  - **信頼性レベル**: 🟢 (TASK-003の認証実装に基づく)

### 6. データベースエラーテスト

- **テスト名**: 保存処理失敗時のエラーハンドリング
  - **何をテストするか**: DB接続エラー時に適切なエラーメッセージが表示される
  - **期待される動作**: ユーザーフレンドリーなエラーメッセージとリトライ案内
  - **入力値**: 有効な更新データ（DBエラーをモック）
  - **期待値**: "保存に失敗しました。しばらく待ってから再度お試しください"
  - **信頼性レベル**: 🟡 (エラーハンドリングの一般的なパターンから推測)

## 境界値テストケース

### 7. 入力値境界テスト

- **テスト名**: ユーザー名の境界値テスト
  - **何をテストするか**: 1文字、50文字の境界値で正常に処理される
  - **期待される動作**: 境界値での正常な保存と表示
  - **入力値**: `{ name: "a" }`, `{ name: "a".repeat(50) }`
  - **期待値**: 正常な更新処理
  - **信頼性レベル**: 🟡 (要件定義のバリデーションルールから推測)

- **テスト名**: 表示件数の境界値テスト
  - **何をテストするか**: 10件、100件の境界値で正常に設定される
  - **期待される動作**: 境界値での正常な設定保存
  - **入力値**: `{ books_per_page: 10 }`, `{ books_per_page: 100 }`
  - **期待値**: 正常な設定更新
  - **信頼性レベル**: 🟡 (要件定義から推測)

## パフォーマンステストケース

### 8. レスポンス時間テスト

- **テスト名**: 設定保存の応答時間テスト
  - **何をテストするか**: 設定更新処理が1秒以内に完了する
  - **期待される動作**: NFR要件の1秒以内レスポンス
  - **入力値**: 標準的な設定更新データ
  - **期待値**: レスポンス時間 < 1000ms
  - **信頼性レベル**: 🟢 (要件定義のパフォーマンス要件に基づく)

- **テスト名**: プロフィール表示の応答時間テスト
  - **何をテストするか**: 初回表示が2秒以内に完了する
  - **期待される動作**: NFR要件の2秒以内表示
  - **入力値**: ユーザーセッション
  - **期待値**: 初回表示時間 < 2000ms
  - **信頼性レベル**: 🟢 (要件定義のパフォーマンス要件に基づく)

## UI/UXテストケース

### 9. レスポンシブ対応テスト

- **テスト名**: モバイル表示の適切なレイアウト
  - **何をテストするか**: モバイル端末でフォームが適切に表示される
  - **期待される動作**: タッチ操作に最適化されたUI表示
  - **入力値**: モバイル画面サイズ (375px幅)
  - **期待値**: 適切な入力フィールドサイズとボタン配置
  - **信頼性レベル**: 🟡 (NFR-203のモバイル対応要件から推測)

### 10. アクセシビリティテスト

- **テスト名**: キーボード操作による設定変更
  - **何をテストするか**: キーボードのみで全ての設定が変更可能
  - **期待される動作**: Tab、Enter、Spaceキーでの操作完了
  - **入力値**: キーボード操作シーケンス
  - **期待値**: マウス操作と同等の機能利用
  - **信頼性レベル**: 🟡 (NFR-202のアクセシビリティ要件から推測)

## 統合テストケース

### 11. 設定反映の統合テスト

- **テスト名**: テーマ変更の他画面への反映
  - **何をテストするか**: プロフィール画面で変更したテーマが本棚画面に反映される
  - **期待される動作**: 設定変更後の即座な全画面テーマ適用
  - **入力値**: テーマ変更 → 画面遷移
  - **期待値**: 一貫したテーマ表示
  - **信頼性レベル**: 🟡 (アプリケーション全体の状態管理から推測)

- **テスト名**: 表示設定の本棚画面への反映
  - **何をテストするか**: 表示モード変更が本棚表示に即座に反映される
  - **期待される動作**: 設定保存後の表示モード切り替え
  - **入力値**: display_mode変更
  - **期待値**: 本棚のグリッド/リスト表示切り替え
  - **信頼性レベル**: 🟡 (本棚機能との統合から推測)

## テスト実行環境

- **ブラウザ**: Chrome, Firefox, Safari（デスクトップ・モバイル）
- **デバイス**: iPhone, Android, タブレット、デスクトップ
- **ネットワーク**: 高速、低速、オフライン状態
- **認証状態**: 新規ユーザー、既存ユーザー、セッション切れ