# TASK-302: モバイル対応・レスポンシブ最適化 - 詳細要件定義

## 概要

既存のhontodanaアプリケーションをモバイルファーストデザインに最適化し、全てのデバイスで最高のユーザー体験を提供する。

## 要件リンク

- **NFR-203**: レスポンシブデザイン要件
- **REQ-404**: モバイル対応要件

## 依存タスク

- **TASK-103**: 本棚表示コンポーネント ✅
- **TASK-201**: 検索・フィルタリング機能 ✅

## 詳細要件

### 1. ブレークポイント設計

#### Tailwind CSS ブレークポイントの活用
```typescript
// 既存のブレークポイント設定を活用
sm: '640px'   // Small tablets and large phones
md: '768px'   // Tablets  
lg: '1024px'  // Laptops
xl: '1280px'  // Desktops
2xl: '1536px' // Large desktops
```

#### レスポンシブ要件
- **Mobile First**: 320px〜から対応
- **Tablet**: 768px〜1023px で最適化
- **Desktop**: 1024px以上で既存レイアウト維持

### 2. 本棚表示の最適化

#### BookCard コンポーネント
- **Mobile (< 640px)**: 1列表示、カード高さ調整
- **Tablet (640px-1023px)**: 2-3列表示
- **Desktop (≥ 1024px)**: 既存の4-5列表示維持

#### BookList コンポーネント  
- **Mobile**: リスト項目の高さとパディング調整
- **テキスト**: 長いタイトルの省略処理改善
- **サムネイル**: モバイル用サイズ最適化

### 3. ナビゲーション最適化

#### モバイルナビゲーション
- **ハンバーガーメニュー**: 768px未満で表示
- **ボトムナビ**: よく使用される機能へのクイックアクセス
- **スワイプジェスチャー**: 画面間の直感的な移動

#### タッチ操作対応
- **タップエリア**: 最小44px×44px（WCAG準拠）
- **スワイプ**: 水平スワイプでページ切り替え
- **ピンチズーム**: 書影やテキストの拡大

### 4. 検索・フィルタリング最適化

#### モバイル検索インターフェース
- **検索バー**: 画面幅いっぱいに拡大
- **フィルター**: アコーディオン式に折りたたみ
- **結果表示**: モバイル最適化されたカードレイアウト

#### 入力最適化
- **仮想キーボード**: 適切なinputType指定
- **オートコンプリート**: タッチ操作しやすいサジェスト
- **音声検索**: ブラウザ標準音声入力対応

### 5. パフォーマンス最適化

#### 画像最適化
- **レスポンシブ画像**: srcSetとsizesの活用
- **遅延読み込み**: インターセクション観察によるLazy Loading
- **WebP対応**: 次世代フォーマットの採用

#### JavaScript最適化
- **コード分割**: 画面ごとの動的インポート
- **プリロード**: 次に表示される可能性の高いリソース
- **Service Worker**: オフライン対応とキャッシュ戦略

### 6. PWA機能（オプション）

#### Manifest設定
```json
{
  "name": "Hontodana - 本棚管理アプリ",
  "short_name": "Hontodana", 
  "display": "standalone",
  "start_url": "/",
  "theme_color": "#3b82f6",
  "background_color": "#ffffff"
}
```

#### オフライン対応
- **読書リスト**: オフライン時でも閲覧可能
- **検索履歴**: ローカルストレージでの保持
- **プログレス同期**: オンライン復帰時のデータ同期

## 受け入れ基準

### 1. レスポンシブデザイン
- [ ] 全画面サイズでレイアウトが適切に表示される
- [ ] 横向き・縦向きの両方に対応している
- [ ] テキストが読みやすいサイズで表示される
- [ ] 画像が適切にリサイズされる

### 2. タッチ操作
- [ ] すべてのインタラクティブ要素がタップしやすい
- [ ] スワイプジェスチャーが正常に動作する
- [ ] ピンチズームが適切に機能する
- [ ] ダブルタップで拡大できる

### 3. パフォーマンス
- [ ] モバイルでのページ読み込み時間が3秒以内
- [ ] 画像の読み込みがスムーズ
- [ ] スクロール性能が快適
- [ ] アニメーションがスムーズに動作

### 4. アクセシビリティ
- [ ] WCAG 2.1 AA基準を満たす
- [ ] スクリーンリーダー対応
- [ ] キーボードナビゲーション対応
- [ ] 適切なフォーカス管理

### 5. PWA要件（オプション）
- [ ] アプリとしてインストール可能
- [ ] オフライン時でも基本機能が利用可能
- [ ] プッシュ通知対応（将来的）

## 技術実装要件

### 1. CSS/Tailwind最適化
```typescript
// レスポンシブクラスの例
className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"
className="text-sm sm:text-base lg:text-lg"
className="p-2 sm:p-4 lg:p-6"
```

### 2. React Hooks活用
```typescript
// ビューポート検知
const useViewport = () => {
  const [viewport, setViewport] = useState({
    width: window.innerWidth,
    height: window.innerHeight
  });
}

// タッチジェスチャー検知
const useSwipe = (onSwipeLeft, onSwipeRight) => {
  // タッチイベントハンドリング
}
```

### 3. Next.js最適化
```typescript
// 画像最適化
<Image
  src={book.coverImage}
  alt={book.title}
  width={200}
  height={300}
  sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
  priority={isAboveTheFold}
/>
```

## 成功指標

### パフォーマンス指標
- **LCP (Largest Contentful Paint)**: 2.5秒以内
- **FID (First Input Delay)**: 100ms以内  
- **CLS (Cumulative Layout Shift)**: 0.1以下
- **TTI (Time to Interactive)**: 3.5秒以内

### ユーザビリティ指標
- **タップ成功率**: 95%以上
- **スワイプ認識率**: 90%以上
- **ページ切り替え速度**: 1秒以内

## 実装優先度

### Phase 1: 基本レスポンシブ対応
1. BookCard/BookListのレスポンシブ化
2. ナビゲーションのモバイル対応
3. 検索フォームの最適化

### Phase 2: タッチ操作強化
1. スワイプジェスチャー実装
2. タップエリアの最適化
3. モバイルナビゲーション追加

### Phase 3: パフォーマンス最適化
1. 画像最適化
2. コード分割
3. キャッシュ戦略実装

### Phase 4: PWA対応（オプション）
1. Manifest設定
2. Service Worker実装
3. オフライン機能追加

## エラーハンドリング

### ビューポート関連
- 画面サイズ変更時のレイアウト再計算
- 横向き・縦向き切り替えの対応
- 異なるデバイス密度への対応

### ネットワーク関連
- オフライン時の優雅な劣化
- 低速回線での読み込み最適化
- 画像読み込みエラーの代替表示

### タッチ操作関連
- 誤タップの防止
- ジェスチャー認識の精度向上
- デバイス固有動作との競合回避